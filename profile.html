<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Card System + Popup</title>

<style>
body{
    margin:0;
    background:#111;
    font-family:Arial;
    display:flex;
    flex-direction:column;
    align-items:center;
    color:white;
    overflow-x:hidden;
}

.top-bar{
    width:100%;
    background:#1c1c1c;
    padding:10px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-sizing:border-box;
}

.storage{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
}

.storage img{
    width:40px;
    height:40px;
    object-fit:cover;
    border-radius:4px;
    border:1px solid #444;
}

.grid{
    margin-top:40px;
    width:1000px;
    height:700px;
    position:relative;
}

.card{
    position:absolute;
    perspective:1000px;
}

.card-inner{
    width:100%;
    height:100%;
    position:relative;
    transition:transform 0.6s;
    transform-style:preserve-3d;
    cursor:pointer;
}

.card.flipped .card-inner{
    transform:rotateY(180deg);
}

.card-face{
    position:absolute;
    width:100%;
    height:100%;
    backface-visibility:hidden;
    border-radius:8px;
    overflow:hidden;
}

.card-front{
    background:#e6e6e6;
}

.card-back{
    background:transparent;
    transform:rotateY(180deg);
    display:flex;
    justify-content:center;
    align-items:center;
}

.card-back img{
    width:85%;
    height:85%;
    object-fit:contain;
}

.card.hide{
    animation:fadeOut 0.5s forwards;
}

@keyframes fadeOut{
    to{
        opacity:0;
        transform:scale(0.4);
        pointer-events:none;
    }
}

/* ===== POPUP SYSTEM (2_var integrated) ===== */

:root {
    --popup-speed: 0.9s;
    --popup-easing: cubic-bezier(.16,1,.3,1);
}

.popup {
    position: fixed;
    top: 50%;
    width: 150px;
    opacity: 0;
    pointer-events: none;
    z-index: 9999;
    transform: translateY(-50%);
    transition:
        transform var(--popup-speed) var(--popup-easing),
        opacity var(--popup-speed) ease;
}

.popup img {
    width: 100%;
    display: block;
}

.popup.left  { left: 0;  transform: translate(-100%, -50%); }
.popup.right { right: 0; transform: translate(100%, -50%); }

.popup.left.show  { transform: translate(-10%, -50%); opacity: 1; }
.popup.right.show { transform: translate(10%, -50%);  opacity: 1; }

</style>
</head>

<body>

<div class="top-bar">
    <div>Осталось переворотов: <span id="moves">10</span></div>
    <div class="storage" id="storage"></div>
</div>

<div class="grid" id="grid"></div>

<script>

/* ===== GAME LOGIC (Cube-bonus) ===== */

const maxMoves = 10;
let movesLeft = maxMoves;

const movesEl = document.getElementById('moves');
const storage = document.getElementById('storage');
const grid = document.getElementById('grid');

const images = [
    "trash/Apelsin.png",
    "trash/Lokon.png",
    "trash/Nosok.png",
    "trash/Palochki.png",
    "trash/Plinka.png",
    "trash/Tea-paket.png",
    "trash/Strela.png",
    "trash/zub.png",
    "trash/Vanna.png",
    "trash/Nosok.png"
];

function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function isOverlapping(newRect, placedRects, gap){
    for(let rect of placedRects){
        if(
            newRect.x < rect.x + rect.w + gap &&
            newRect.x + newRect.w + gap > rect.x &&
            newRect.y < rect.y + rect.h + gap &&
            newRect.y + newRect.h + gap > rect.y
        ){
            return true;
        }
    }
    return false;
}

const shuffled = shuffle([...images, ...images]);
const placedRects = [];
const GAP = 25;

for(let i=0;i<20;i++){

    const size = 100 + Math.random()*30;
    let placed = false;
    let attempts = 0;
    let x, y;

    while(!placed && attempts < 1000){
        x = Math.random() * (grid.clientWidth - size);
        y = Math.random() * (grid.clientHeight - size);
        const newRect = { x, y, w:size, h:size };

        if(!isOverlapping(newRect, placedRects, GAP)){
            placedRects.push(newRect);
            placed = true;
        }
        attempts++;
    }

    if(!placed) continue;

    const card = document.createElement('div');
    card.className = 'card';
    card.style.width = size + "px";
    card.style.height = size + "px";
    card.style.left = x + "px";
    card.style.top = y + "px";

    const rotate = (Math.random()-0.5)*6;
    card.style.transform = `rotate(${rotate}deg)`;

    card.innerHTML = `
        <div class="card-inner">
            <div class="card-face card-front"></div>
            <div class="card-face card-back">
                <img src="${shuffled[i]}">
            </div>
        </div>
    `;

    grid.appendChild(card);
}

document.addEventListener("click", function(e){

    const card = e.target.closest(".card");
    if(!card) return;
    if(movesLeft <= 0) return;
    if(card.classList.contains('flipped')) return;

    movesLeft--;
    movesEl.textContent = movesLeft;

    card.classList.add('flipped');

    const imgSrc = card.querySelector('img').src;
    const img = document.createElement('img');
    img.src = imgSrc;
    storage.appendChild(img);

    setTimeout(()=>{
        card.classList.add('hide');
    },1000);
});

/* ===== POPUP SYSTEM (2_var integrated) ===== */

const leftImages = ["Ruka/ruka2.png","Ruka/ruka_2.png"];
const rightImages = ["Ruka/ruka.png","Ruka/ruka_1.png"];

function randomFromArray(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

function createPopup() {

    const popup = document.createElement("div");
    popup.className = "popup";

    const side = Math.random() < 0.5 ? "left" : "right";
    popup.classList.add(side);

    const img = new Image();
    img.src = side === "left"
        ? randomFromArray(leftImages)
        : randomFromArray(rightImages);

    popup.appendChild(img);
    document.body.appendChild(popup);

    requestAnimationFrame(() => {
        requestAnimationFrame(() => {
            popup.classList.add("show");
        });
    });

    setTimeout(() => {
        popup.classList.remove("show");
        setTimeout(() => popup.remove(), 900);
    }, 5000);
}

/* Автоматический запуск как в 2_var */

setInterval(createPopup, 10000);
setTimeout(createPopup, 10000);

</script>

</body>
</html>
